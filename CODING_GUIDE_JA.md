# コーディングガイド

このリポジトリは iOS アプリ「今日ゴミ出し」の Flutter プロジェクトです。ディレクトリ構成や実装例から読み取ったコーディングルールを以下にまとめます。

## 1. プロジェクト構成

```
lib/
  ├── models/        # データクラス（JSON シリアライズ可能）
  ├── repository/    # データアクセス層とサービスラッパー
  ├── usecase/       # ドメインサービスとインタフェース
  ├── viewModels/    # ウィジェット用の状態クラス（ChangeNotifier）
  ├── view_common/   # 共有 UI ユーティリティ
  *.dart             # ページウィジェットとアプリのエントリ
test/
  ├── unit/          # ユニットテスト
  └── widget/        # ウィジェットテスト
json/                # 環境別設定ファイル
dart_defines/        # ビルド時の定義値
```

## 2. コードスタイルの規約

- **インデント:** 2 スペース
- **インポート:** パッケージごとに空行を挟む
- **命名:**
  - クラス、enum、typedef: `PascalCase`
  - 変数、メソッド: `camelCase`
  - 定数: `UPPER_SNAKE_CASE`
- **コメント:** 日本語で簡潔に記述する
- **文字列:** 特別な理由がない限りシングルクォートを使用する
- **非同期処理:** I/O を行う関数は `Future<T>` を返し `async`/`await` を利用する

## 3. アーキテクチャのパターン

- **Repository パターン**
  - 永続化処理を `repository` 配下でカプセル化し、非同期 CRUD メソッドを提供する
  - 実装クラスは `lib/usecase/repository` に配置したインタフェースを実装する
- **Service（Usecase）層**
  -  repository インタフェースに依存し、より高レベルのワークフローを提供する
- **シングルトン初期化**
  - 多くのサービスやリポジトリは `initialize` メソッドで一度だけ初期化し、`factory` コンストラクタでインスタンスを取得する
- **状態管理**
  - `ChangeNotifier` を継承した ViewModel を `Provider` 経由で注入する
- **設定ファイル**
  - `json/` や `dart_defines/` の値を `AppConfigProvider` 経由で参照する

## 4. テスト

- **ユニットテスト:** `test/unit/` 配下で `flutter_test` と `mockito` を使用する
- **ウィジェットテスト:** `test/widget/` で `pumpWidget` と Provider を利用して UI を検証する
- **実行方法:** プロジェクトルートで `flutter test` を実行する

## 5. 推奨事項

1. 新しいファイルはレイヤーごとに適切なディレクトリへ配置する
2. 依存関係はインタフェース経由で注入し、テストでモック可能にする
3. 予期しないエラーは Crashlytics へ報告し、リポジトリやサービスは `Future<bool>` で成功可否を返す
4. デバッグやエラー出力には `logger` パッケージを使用する
5. シングルトンの再初期化を避け、アプリ起動時に一度だけ `initialize` を呼び出す
6. ロジックのあるクラスにはユニットテストを、UI にはウィジェットテストを用意する
